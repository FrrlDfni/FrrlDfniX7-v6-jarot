{"version":3,"file":"tiny-timer.module.js","sources":["../src/tiny-timer.ts"],"sourcesContent":["import mitt, { EventType, Handler } from 'mitt'\n\ntype Status = 'running' | 'paused' | 'stopped'\n\nclass Timer {\n  private _interval: number\n  private _stopwatch: boolean\n  private _duration: number = 0\n  private _endTime: number = 0\n  private _pauseTime: number = 0\n  private _status: Status = 'stopped'\n  private _timeoutID?: NodeJS.Timeout\n  private _emitter = mitt()\n\n  constructor ({ interval = 1000, stopwatch = false } = {}) {\n    this._interval = interval\n    this._stopwatch = stopwatch\n  }\n\n  public start (duration: number, interval?: number) {\n    if (this.status !== 'stopped') return\n    if (duration == null) {\n      throw new TypeError('Must provide duration parameter')\n    }\n    this._duration = duration\n    this._endTime = Date.now() + duration\n    this._changeStatus('running')\n    this._emitter.emit('tick', this._stopwatch ? 0 : this._duration)\n    this._timeoutID = setInterval(this.tick, interval || this._interval)\n  }\n\n  public stop () {\n    if (this._timeoutID) clearInterval(this._timeoutID)\n    this._changeStatus('stopped')\n  }\n\n  public pause () {\n    if (this.status !== 'running') return\n    this._pauseTime = Date.now()\n    this._changeStatus('paused')\n  }\n\n  public resume () {\n    if (this.status !== 'paused') return\n    this._endTime += Date.now() - this._pauseTime\n    this._pauseTime = 0\n    this._changeStatus('running')\n  }\n\n  private _changeStatus (status: Status) {\n    this._status = status\n    this._emitter.emit('statusChanged', this.status)\n  }\n\n  private tick = () => {\n    if (this.status === 'paused') return\n    if (Date.now() >= this._endTime) {\n      this.stop()\n      this._emitter.emit('tick', this._stopwatch ? this._duration : 0)\n      this._emitter.emit('done')\n    } else {\n      this._emitter.emit('tick', this.time)\n    }\n  }\n\n  get time () {\n    if (this.status === 'stopped') return 0\n    const time = this.status === 'paused' ? this._pauseTime : Date.now()\n    const left = this._endTime - time\n    return this._stopwatch ? this._duration - left : left\n  }\n\n  get duration () {\n    return this._duration\n  }\n\n  get status () {\n    return this._status\n  }\n\n  public on (eventName: EventType, handler: Handler<any>) {\n    this._emitter.on(eventName, handler)\n  }\n\n  public off (eventName: EventType, handler: Handler<any>) {\n    this._emitter.off(eventName, handler)\n  }\n}\n\nexport default Timer\n"],"names":["Timer","constructor","interval","stopwatch","mitt","status","Date","now","_endTime","stop","_emitter","emit","_stopwatch","_duration","time","_interval","start","duration","TypeError","_changeStatus","_timeoutID","setInterval","tick","clearInterval","pause","_pauseTime","resume","_status","left","on","eventName","handler","off"],"mappings":"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"}